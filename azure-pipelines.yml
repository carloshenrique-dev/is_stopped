trigger:
- master

pool:
  vmImage: 'macos-latest'

steps:
    - task: FlutterInstall@0
      inputs:
        mode: 'auto'
        channel: 'stable'
        version: 'latest'

    - script: |
        flutter doctor
      displayName: 'Flutter Doctor'

    - task: Cache@2
      inputs:
        key: 'flutter | "$(Agent.OS)" | $(flutterVersion)'
        path: '$(FLUTTER_HOME)'
        cacheHitVar: FLUTTER_CACHE_HIT
      displayName: Cache Flutter SDK

    - script: |
        flutter pub get
      displayName: 'Flutter Pub Get'
      
    - script: |
        flutter build ios
        xcodebuild archive -workspace '**/ios/Runner.xcworkspace' -scheme 'Runner' -configuration 'Release' -sdk 'iphoneos' -archivePath './Runner.xcarchive' CODE_SIGN_STYLE='Manual' DEVELOPMENT_TEAM='YOUR_TEAM_ID' CODE_SIGN_IDENTITY='iPhone Distribution' PROVISIONING_PROFILE_SPECIFIER='H93F57BRA4'
      displayName: 'Archive'
